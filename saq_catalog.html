<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View our catalogue</title>

    <!-- init firebase mega thing-->
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
    <!-- init firestore -->
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
    <!-- init SAQ firebase -->
    <script src="firebase_config.js"></script>
    <!-- init SAQ objects -->
    <script src="SAQ_objects.js"></script>
</head>
<body>
    <div id="clint">
        <table>
            <tr>
                <td>
                    <table class="picture">
                            <tr><td><img id="clint_pic" height="100" width="100"></td></tr>
                    </table>
                </td>
                <td>
                    <table class= "chair_info">
                        <tr><td id="clint_name"></td></tr>
                        <tr><td id="clint_comfort_options"></td></tr>
                        <tr><td id="clint_price"></td><td id="clint_rating"></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <div id="fahad">
        <table>
            <tr>
                <td>
                    <table class="picture">
                        <tr><td><img id="fahad_pic" height="100" width="100"></td></tr>
                    </table>
                </td>
                <td>
                    <table class= "chair_info">
                        <tr><td id="fahad_name"></td></tr>
                        <tr><td id="fahad_comfort_options"></td></tr>
                        <tr><td id="fahad_price"></td><td id="fahad_rating"></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <div id="em">
        <table>
            <tr>
                <td>
                    <table class="picture">
                        <tr><td><img id="em_pic" height="100" width="100"></td></tr>
                    </table>
                </td>
                <td>
                    <table class= "chair_info">
                        <tr><td id="em_name"></td></tr>
                        <tr><td id="em_comfort_options"></td></tr>
                        <tr><td id="em_price"></td><td id="em_rating"></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <div id="neda">
        <table>
            <tr>
                <td>
                    <table class="picture">
                        <tr><td><img id="neda_pic" height="100" width="100"></td></tr>
                    </table>
                </td>
                <td>
                    <table class= "chair_info">
                        <tr><td id="neda_name"></td></tr>
                        <tr><td id="neda_comfort_options"></td></tr>
                        <tr><td id="neda_price"></td><td id="neda_rating"></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <div id="sam">
        <table>
            <tr>
                <td>
                    <table class="picture">
                        <tr><td><img id="sam_pic" height="100" width="100"></td></tr>
                    </table>
                </td>
                <td>
                    <table class= "chair_info">
                        <tr><td id="sam_name"></td></tr>
                        <tr><td id="sam_comfort_options"></td></tr>
                        <tr><td id="sam_price"></td><td id="sam_rating"></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <div id="chris">
        <table>
            <tr>
                <td>
                    <table class="picture">
                        <tr><td><img id="chris_pic" height="100" width="100"></td></tr>
                    </table>
                </td>
                <td>
                    <table class= "chair_info">
                        <tr><td id="chris_name"></td></tr>
                        <tr><td id="chris_comfort_options"></td></tr>
                        <tr><td id="chris_price"></td><td id="chris_rating"></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <script>var the_db = firebase.firestore();</script>
    <script>
        // Get a prefix based on the chair name
        function get_prefix(chair_name) {
            if (chair_name === 'the Clint') {
                return 'clint_';
            }
            else if (chair_name === 'the Fahad') {
                return 'fahad_';
            }
            else if (chair_name === 'the Em') {
                return 'em_';
            }
            else if (chair_name === 'the Neda') {
                return 'neda_';
            }
            else if (chair_name === 'the Sam') {
                return 'sam_';
            }
            else if (chair_name === 'the Chris') {
                return 'chris_';
            }
        }

        // Calculate an average
        function calculate_average(arr) {
            let sum = 0;

            for (let i = 0; i < arr.length; i++) {
                sum += arr[i];
            }

            return Math.floor(sum/arr.length);
        }

        // Get a chair from the DB
        function get_single_chair(chair_id) {
            let db_ref = the_db.collection("Chairs").doc(chair_id);

            db_ref.get().then(function(doc){
                if (doc.exists){
                    let ratings =  doc.data().ratings;
                    let options = [doc.data().firmness,  doc.data().back_support, doc.data().arms];
                    //id, name, price, comfort_options, ratings, picture
                    let chair = new Chair(doc.data().id, doc.data().name, doc.data().price, options, ratings, doc.data().picture);

                    document.getElementById('chair_name').innerHTML = chair.name;
                    document.getElementById('price').innerHTML = "$" + chair.price;
                    document.getElementById('rating').innerHTML = chair.ratings;
                    document.getElementById('pic').src = chair.picture;
                }
                else {
                    console.log("Didn't work");
                }
            }).catch(function(error) {
                console.log("Threw error " + error);
            });
        }

        function display_catalog() {
            let db_ref = the_db.collection("clints_work"); // ToDo <----- replace with live Collection

            db_ref.get().then(function(catalog) {
               // Create a div area and put the chair into it
               catalog.forEach(function(doc){
                   let name = doc.data().name;
                   let prefix = get_prefix(name);

                   document.getElementById(prefix + "name").innerHTML = name;
                   document.getElementById(prefix + "price").innerHTML = '$' + doc.data().price;
                   document.getElementById(prefix + "rating").innerHTML = "Average rating: " + calculate_average(doc.data().ratings);
                   document.getElementById(prefix + "pic").src = doc.data().picture;
               })
            }).catch(function(error) {
                console.log("Error displaying all items");
            });
        }
        // Code to insert chair info into web-page
        // get_single_chair("chair_0");
        display_catalog();
    </script>

</body>
</html>