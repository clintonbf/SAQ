<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Our Catalogue</title>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css"/>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
    <script src="firebase_config.js"></script>
    <script src="SAQ_db_functions.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="css/custom.css" rel="stylesheet">
<!--    <script>-->
<!--        let chair_arr = create_chairs_array();-->
<!--    </script>-->
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="main.html">Home</a>
    <a id = "login-nav" class="navbar-brand" href="userLogin.html">Login</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup"
            aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
            <a class="nav-item nav-link active" href="main.html">Home</a>
            <a class="nav-item nav-link" href="saq_catalog.html">Catalog</a>
        </div>
    </div>
</nav>

<img alt="neutral_chair" class="img-fluid" src="images/home_page/chair_blue_bookshelf.jpeg">
<div class = "jumbotron jumbotron-fluid HeaderMain">
    <a href="main.html" class="no-dec">
        <div class = "container"><img class="chair-icon" src="images/home_page/iconchair.png" alt = "chair-icon">
            <p class = "usergreeting" id="EmRocks" style="display: inline"> Welcome </p>
            <h1 class="display-4 header-text"> Site Title </h1>
        </div>
    </a>
</div>

<script>
let selectedChairs = [];
let cartCount = 0;
        // Get a prefix based on the chair name

        // Get a prefix based on the chair name. This is necessary for certain fields since they don't
        // all share the same name structure
        function get_prefix(chair_name) {
            if (chair_name === 'the Clint') {
                return 'clint_';
            }
            else if (chair_name === 'the Fahad') {
                return 'fahad_';
            }
            else if (chair_name === 'the Em') {
                return 'em_';
            }
            else if (chair_name === 'the Neda') {
                return 'neda_';
            }
            else if (chair_name === 'the Sam') {
                return 'sam_';
            }
            else if (chair_name === 'the Chris') {
                return 'chris_';
            }
        }

        // Calculate an average
        function calculate_average(arr) {
            let sum = 0;

            for (let i = 0; i < arr.length; i++) {
                sum += arr[i];
            }

            return Math.floor(sum/arr.length);
        }

        // Get a chair from the DB
        function get_single_chair(chair_id) {
            let db_ref = the_db.collection("Chairs").doc(chair_id);

            db_ref.get().then(function(doc){
                if (doc.exists){
                    let ratings =  doc.data().ratings;
                    let options = [doc.data().firmness,  doc.data().back_support, doc.data().arms];
                    //id, name, price, comfort_options, ratings, picture
                    let chair = new Chair(doc.data().id, doc.data().name, doc.data().price, options, ratings, doc.data().picture);

                    document.getElementById('chair_name').innerHTML = chair.name;
                    document.getElementById('price').innerHTML = "$" + chair.price;
                    document.getElementById('rating').innerHTML = chair.ratings;
                    document.getElementById('pic').src = chair.picture;
                }
                else {
                    console.log("Didn't work");
                }
            })
                .catch(function(error) {
                console.log("Threw error " + error);
            });
        }

        function addChair(doc, name) {
            let dbRef = the_db.collection("Chairs").get().then(function (querySnapshot) {
                querySnapshot.forEach(function (doc) {
                if (doc.data().name === name) {
                    selectedChairs.push(doc.data());
                    console.log(selectedChairs);
                    cartCount ++;
                    document.getElementById('cart').innerHTML = "Cart: " + cartCount.toString();
                    console.log("works")
                }
            })
            //     .catch(function (error) {
            //     console.log("Error displaying all items");
            // })
            })
        }

        function display_catalog() {
            let db_ref = the_db.collection("clints_work"); // ToDo <----- replace with live Collection

            db_ref.get().then(function (catalog) {
                // Create a div area and put the chair into it
                catalog.forEach(function (doc) {
                    let name = doc.data().name;
                    let prefix = get_prefix(name);

                    //The following code is an attempt to auto-generate the HTML
                    let div_tag = document.createElement("div");
                    div_tag.setAttribute("class", "container catalog-div");
                    div_tag.setAttribute("id", prefix +"goto");
                    document.body.appendChild(div_tag);

                    let table_parent = document.createElement("table");
                    table_parent.setAttribute("class", "display-4 catalog-div-text");
                    div_tag.appendChild(table_parent);

                    let tr_parent = document.createElement("tr");
                    table_parent.appendChild(tr_parent);
                    let td_1 = document.createElement("td");
                    tr_parent.appendChild(td_1);

                    let table_child_1 = document.createElement("table");
                    table_child_1.setAttribute("class", "picture");
                    td_1.appendChild(table_child_1);
                    let tr_child_1 = document.createElement("tr");
                    table_child_1.appendChild(tr_child_1);
                    let td_child_1 = document.createElement('td');
                    tr_child_1.appendChild(td_child_1);
                    let chair_image = document.createElement("img");
                    chair_image.setAttribute("class", "img-fluid catalog-images");
                    chair_image.setAttribute("id", prefix + "pic");
                    td_child_1.appendChild(chair_image);

                    let td_2 = document.createElement("td");
                    tr_parent.appendChild(td_2);
                    let table_child_2 = document.createElement("table");
                    //table_child_2.setAttribute("class", "chair_info");
                    td_2.appendChild(table_child_2);

                    let specs = [prefix + "name", prefix + "comfort_options", prefix + "price", prefix + "rating"];
                    for (let i = 0; i < specs.length; i++) {
                        let tr_spec = document.createElement("tr");
                        table_child_2.appendChild(tr_spec);
                        let td_spec = document.createElement("td");
                        td_spec.setAttribute("id", specs[i]);
                        tr_spec.appendChild(td_spec);
                    }

                    let tr_add = document.createElement("tr");
                    table_child_2.appendChild(tr_add);
                    let td_add = document.createElement("td");
                    tr_add.appendChild(td_add);

                    let add_name = name.split(" ")[1];
                    add_name = add_name.charAt(0).toLowerCase() + add_name.slice(1);

                    let div_add = document.createElement("div");
                    div_add.setAttribute("id", add_name + "Add");
                    div_add.setAttribute("class", "quick-add");
                    div_add.innerHTML = "quick add";
                    td_add.appendChild(div_add);

                    // Now back to our filling of the table
                    document.getElementById(prefix + "name").innerHTML = name;
                    document.getElementById(prefix + "price").innerHTML = '$' + doc.data().price;
                    document.getElementById(prefix + "rating").innerHTML = "Average rating: " + calculate_average(doc.data().ratings);
                    document.getElementById(prefix + "pic").src = doc.data().picture;
                });

                document.getElementById("clintAdd").addEventListener("click", function () {
                    addChair("chair_0", 'the Clint');
                });
                document.getElementById("fahadAdd").addEventListener("click", function () {
                    addChair("chair_1", 'the Fahad');
                });
                document.getElementById("emAdd").addEventListener("click", function () {
                    addChair("chair_2", 'the Em');
                });
                document.getElementById("nedaAdd").addEventListener("click", function () {
                    addChair("chair_3", 'the Neda');
                });
                document.getElementById("samAdd").addEventListener("click", function () {
                    addChair("chair_4", 'the Sam');
                });
                document.getElementById("chrisAdd").addEventListener("click", function () {
                    addChair("chair_5", 'the Chris');
                });
            }).catch(function (error) {
                console.log("Error displaying all items, " + error);
            });

        }

        display_catalog();

        function filter_by_price() {
            // Use JS to loop through the chairs_array
            // and set the CSS display:none property according to the filter-criteria and the element_id

            let min_price = document.getElementById('min_price');
            let max_price = document.getElementById('max_price');

            //Set a CSS display property to hidden or visible
        }
    </script>



<!--<div id = "ourCart" class="container" style = "background-color: grey;"><button type = "button" class="btn btn-outline-secondary" style="background-color: #3c3f41; padding: 15px; width: 100px; position: absolute; left: 70%">-->
<!--    <a href="shopping_cart.html" style = "color: white"><p id = "cart"> Cart </p></a></button><div></div>-->
<!--</div>-->

<nav class="navbar fixed-bottom navbar-dark bg-dark">

    <form class="form-inline">
        <button class="btn btn-sm btn-outline-secondary" type="button">
<<<<<<< HEAD
            <a class="navbar-brand" href="usercheckout.html" > Check Out</a>
=======
            <a id = "our-cart" class="navbar-brand" href="shopping_cart.html" > Check Out </a>
>>>>>>> 02389679bfd8ccc10c6b6e8d45e8b0b6f245e571
            <p id="cart"> Cart: 0 </p>
        </button>
    </form>
</nav>
<script>
    document.getElementById('our-cart').addEventListener("click", storeCart);

    function storeCart(){
        localStorage.setItem('cartItems', JSON.stringify(selectedChairs));
    }
    displayUser();
    console.log(selectedChairs);
</script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>
